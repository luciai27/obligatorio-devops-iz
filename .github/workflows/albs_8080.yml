name: Buscar ALBs

on:
  push:
    branches: [dev, test, main]
  pull_request:
    branches: [dev, test, main]

jobs:
  buscar-albs:
    runs-on: ubuntu-latest

    steps:
      - name: Configurar credenciales AWS
        uses: aws-actions/configure-aws-credentials@v3
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: us-east-1
          aws-session-token: ${{ secrets.AWS_SESSION_TOKEN }}
          
      - name: Obtener DNS de los dos primeros ELBs
        id: elb_dns
        run: |
          echo "Obteniendo lista de DNS de ELBs..."

          dns_output=$(aws elb describe-load-balancers \
            --region us-east-1 \
            --query "LoadBalancerDescriptions[*].DNSName" \
            --output text)

          echo "Resultado crudo:"
          echo "$dns_output"

          # Convertir en array (espacios separan DNS)
          dns_array=($dns_output)

          # Asignar a variables individuales
          dns1="${dns_array[0]}"
          dns2="${dns_array[1]}"

          echo "Primer ELB: $dns1"
          echo "Segundo ELB: $dns2"

          # Exportar como outputs
          echo "elb1=$dns1" >> $GITHUB_OUTPUT
          echo "elb2=$dns2" >> $GITHUB_OUTPUT

